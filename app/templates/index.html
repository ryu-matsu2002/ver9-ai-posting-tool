{% extends 'base.html' %}
{% block title %}è¨˜äº‹ç”Ÿæˆ{% endblock %}

{% block content %}
<h1>è¨˜äº‹ã‚’ç”Ÿæˆã™ã‚‹</h1>

<form method="POST">
    <!-- ğŸ”½ ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
    <label for="genre_select">ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠï¼ˆç™»éŒ²æ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‡ªå‹•åæ˜ ï¼‰ï¼š</label><br>
    <select id="genre_select" style="width: 100%; padding: 8px; margin-bottom: 20px;">
        <option value="">-- ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
        {% for g in genres %}
            <option value="{{ g.genre }}">{{ g.genre }}</option>
        {% endfor %}
    </select><br>

    <label for="keywords">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆ1è¡Œã«1ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æœ€å¤§40ä»¶ï¼‰ï¼š</label><br>
    <textarea id="keywords" name="keywords" rows="10" required
              style="width: 100%; padding: 8px; margin-bottom: 20px;"
              placeholder="ä¾‹ï¼š\nä¸€äººæ—…ã€€ãŠã™ã™ã‚\nç¡çœ ã®è³ªã€€æ”¹å–„\nSEOå¯¾ç­–ã€€æ–¹æ³•\n..."></textarea><br>

    <label for="title_prompt">è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</label><br>
    <textarea id="title_prompt" name="title_prompt" rows="3" required style="width: 100%; padding: 8px; margin-bottom: 15px;"></textarea><br>

    <label for="body_prompt">è¨˜äº‹æœ¬æ–‡ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</label><br>
    <textarea id="body_prompt" name="body_prompt" rows="6" required style="width: 100%; padding: 8px; margin-bottom: 20px;"></textarea><br>

    <button type="submit" style="background-color: #1a73e8; color: white; border: none; padding: 10px 20px; cursor: pointer;">
        ç”Ÿæˆã™ã‚‹
    </button>
</form>

{% if results %}
    <hr>
    <h2>ç”Ÿæˆã•ã‚ŒãŸè¨˜äº‹ä¸€è¦§ï¼ˆ{{ results | length }} ä»¶ï¼‰</h2>
    {% for item in results %}
        <div style="margin-bottom: 40px; padding: 20px; background-color: #ffffff; border: 1px solid #ccc; border-radius: 8px;">
            <h3>{{ item.title }}</h3>
            <div style="white-space: pre-wrap; margin-bottom: 10px;">{{ item.content }}</div>
            {% if item.image_url %}
                <img src="{{ item.image_url }}" alt="è¨˜äº‹ç”»åƒ" style="max-width: 100%; margin-top: 10px;">
            {% endif %}
        </div>
    {% endfor %}
{% endif %}

<!-- ğŸ” JSã§ã‚¸ãƒ£ãƒ³ãƒ«ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‡ªå‹•åæ˜  -->
<script>
    document.getElementById("genre_select").addEventListener("change", function () {
        const genre = this.value;
        if (!genre) return;

        fetch(`/get_prompt/${encodeURIComponent(genre)}`)
            .then(res => res.json())
            .then(data => {
                if (data.title_prompt && data.body_prompt) {
                    document.getElementById("title_prompt").value = data.title_prompt;
                    document.getElementById("body_prompt").value = data.body_prompt;
                } else {
                    alert("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }
            })
            .catch(err => {
                alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                console.error(err);
            });
    });
</script>
{% endblock %}
